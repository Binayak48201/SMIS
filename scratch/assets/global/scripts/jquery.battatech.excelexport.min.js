!function(e){var t={containerid:null,filename:"my_file",extension:"xls",datatype:"table",dataset:null,columns:null,returnUri:!1,worksheetName:"My Worksheet",encoding:"utf-8"},n=t;e.fn.battatech_excelexport=function(a){function i(){var e=n.datatype.toLowerCase();switch(r(e),e){case"table":d=c(s());break;case"json":d=c(o());break;case"xml":d=c(o());break;case"jqgrid":d=c(o())}return n.returnUri?d:a(d,n)}function a(e,t){var n=document.createElement("a");if(n.setAttribute("href",e),n.setAttribute("download",t.filename+"."+t.extension),document.createEvent){var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0),n.dispatchEvent(a)}else n.click()}function r(t){switch(t){case"table":break;case"json":u=n.dataset;break;case"xml":e(n.dataset).find("row").each(function(t,n){var a={};null!=this.attributes&&this.attributes.length>0&&(e(this.attributes).each(function(){a[this.name]=this.value}),u.push(a))});break;case"jqgrid":e(n.dataset).find("rows > row").each(function(t,n){var a={};null!=this.children&&this.children.length>0&&(e(this.children).each(function(){a[this.tagName]=e(this).text()}),u.push(a))})}}function s(){var t=e("<div>").append(e("#"+n.containerid).clone()).html();return t}function o(){var t="<table>";return t+="<thead><tr>",e(n.columns).each(function(e,n){1!=this.ishidden&&(t+="<th",null!=this.width&&(t+=" style='width: "+this.width+"'"),t+=">",t+=this.headertext,t+="</th>")}),t+="</tr></thead>",t+="<tbody>",e(u).each(function(a,i){t+="<tr>",e(n.columns).each(function(e,n){i.hasOwnProperty(this.datafield)&&1!=this.ishidden&&(t+="<td",null!=this.width&&(t+=" style='width: "+this.width+"'"),t+=">",t+=i[this.datafield],t+="</td>")}),t+="</tr>"}),t+="</tbody>",t+="</table>"}function c(e){var a="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";a+="<head>",a+='<meta http-equiv="Content-type" content="text/html;charset='+t.encoding+'" />',a+="<!--[if gte mso 9]>",a+="<xml>",a+="<x:ExcelWorkbook>",a+="<x:ExcelWorksheets>",a+="<x:ExcelWorksheet>",a+="<x:Name>",a+="{worksheet}",a+="</x:Name>",a+="<x:WorksheetOptions>",a+="<x:DisplayGridlines/>",a+="</x:WorksheetOptions>",a+="</x:ExcelWorksheet>",a+="</x:ExcelWorksheets>",a+="</x:ExcelWorkbook>",a+="</xml>",a+="<![endif]-->",a+="</head>",a+="<body>",a+=e.replace(/"/g,"'"),a+="</body>",a+="</html>";var i="data:application/vnd.ms-excel;base64,",r={worksheet:n.worksheetName,table:e};return i+h(l(a,r))}function h(e){return window.btoa(unescape(encodeURIComponent(e)))}function l(e,t){return e.replace(/{(\w+)}/g,function(e,n){return t[n]})}n=e.extend({},t,a);var d,u=[];return i()}}(jQuery);